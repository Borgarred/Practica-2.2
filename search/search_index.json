{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Pr\u00e1ctica 2.2 \u2013 Autenticaci\u00f3n en Nginx","text":""},{"location":"#paquetes-necesarios","title":"Paquetes necesarios","text":"<p>Para esta pr\u00e1ctica podemos utilizar la herramienta openssl para crear las contrase\u00f1as.</p> <p>En primer lugar debemos comprobar si el paquete est\u00e1 instalado:</p> <pre><code>dpkg -l | grep openssl\n</code></pre> <p>Y si no lo estuviera, instalarlo.</p>"},{"location":"#creacion-de-usuarios-y-contrasenas-para-el-acceso-web","title":"Creaci\u00f3n de usuarios y contrase\u00f1as para el acceso web","text":"<p>Creamos un archivo oculto llamado \u201c.htpasswd\u201d en el directorio de configuraci\u00f3n /etc/nginx donde guardar nuestros usuarios y contrase\u00f1as:</p> <pre><code>sudo sh -c \"echo -n 'vuestro_nombre:' &gt;&gt; /etc/nginx/.htpasswd\"\n</code></pre> <p>Ahora crearemos un pasword cifrado para el usuario:</p> <pre><code>sudo sh -c \"openssl passwd -apr1 &gt;&gt; /etc/nginx/.htpasswd\"\n</code></pre> <p>Este proceso se podr\u00e1 repetir para tantos usuarios como haga falta.</p> <p>Crea dos usuarios, uno con tu nombre y otro con tu primer apellido Comprueba que el usuario y la contrase\u00f1a aparecen cifrados en el fichero:</p> <pre><code>cat /etc/nginx/.htpasswd\n</code></pre> <p></p>"},{"location":"#configurando-el-servidor-nginx-para-usar-autenticacion-basica","title":"Configurando el servidor Nginx para usar autenticaci\u00f3n b\u00e1sica","text":"<p>Editaremos la configuraci\u00f3n del server block sobre el cual queremos aplicar la restricci\u00f3n de acceso.</p> <pre><code>sudo nano /etc/nginx/sites-available/nombre_web\n</code></pre> <p>Utilizaremos la directiva <code>auth_basic</code> dentro del location y le pondremos el nombre a nuestro dominio que ser\u00e1 mostrado al usuario al solicitar las credenciales. Por \u00faltimo, configuramos Nginx para que utilice el fichero que previamente hemos creado con la directiva <code>auth_basic_user_file</code>:</p> <p></p> <p>Una vez terminada la configuraci\u00f3n, reiniciamos el servicio.</p> <pre><code>sudo systemctl restart nginx\n</code></pre>"},{"location":"#comprobacion-1","title":"Comprobaci\u00f3n 1","text":"<p>Comprueba desde tu m\u00e1quina f\u00edsica/anfitri\u00f3n que puedes acceder a http://nombre-sitio-web y que se te solicita autenticaci\u00f3n</p> <p></p>"},{"location":"#comprobacion-2","title":"Comprobaci\u00f3n 2","text":"<p>Comprueba que si decides cancelar la autenticaci\u00f3n, se te negar\u00e1 el acceso al sitio con un error. \u00bfQu\u00e9 error es?</p> <p></p>"},{"location":"#tarea-1","title":"Tarea 1","text":"<p>Intenta entrar primero con un usuario err\u00f3neo y luego con otro correcto. Puedes ver todos los sucesos y registros en los logs access.log y error.log</p> <p>Adjunta una captura de pantalla de los logs donde se vea que intentas entrar primero con un usuario inv\u00e1lido y con otro v\u00e1lido. Indica d\u00f3nde podemos ver los errores de usuario inv\u00e1lido o no encontrado, as\u00ed como donde podemos ver el n\u00famero de error que os aparec\u00eda antes</p> <p>Usuario inv\u00e1lido:</p> <p>access.log  error.log: </p> <p>Usuario v\u00e1lido:</p> <p>access.log  error.log: No hay error ya que el usuario es v\u00e1lido.</p>"},{"location":"#tarea-2","title":"Tarea 2","text":"<p>Borra las dos l\u00edneas que hacen referencia a la autenticaci\u00f3n b\u00e1sica en el location del directorio ra\u00edz. Tras ello, a\u00f1ade un nuevo location debajo con la autenticaci\u00f3n b\u00e1sica para el archivo/secci\u00f3n contact.html \u00fanicamente.</p> <p></p>"},{"location":"#combinacion-de-la-autenticacion-basica-con-la-restriccion-de-acceso-por-ip","title":"Combinaci\u00f3n de la autenticaci\u00f3n b\u00e1sica con la restricci\u00f3n de acceso por IP","text":""},{"location":"#tarea-1_1","title":"Tarea 1","text":"<p>Configura Nginx para que no deje acceder con la IP de la m\u00e1quina anfitriona al directorio ra\u00edz de una de tus dos webs. Modifica su server block o archivo de configuraci\u00f3n. Comprueba como se deniega el acceso:</p> <p></p> <p>Al intentar acceder nos encontramos con error</p> <p></p> <p>error.log: </p>"},{"location":"#tarea-2_1","title":"Tarea 2","text":"<p>Configura Nginx para que desde tu m\u00e1quina anfitriona se tenga que tener tanto una IP v\u00e1lida como un usuario v\u00e1lido, ambas cosas a la vez, y comprueba que s\u00ed puede acceder sin problemas</p> <p> </p>"},{"location":"#cuestion-1","title":"Cuesti\u00f3n 1","text":"<p>Supongamos que yo soy el cliente con la IP 172.1.10.15 e intento acceder al directorio web_muy_guay de mi sitio web, equivoc\u00e1ndome al poner el usuario y contrase\u00f1a. \u00bfPodr\u00e9 acceder?\u00bfPor qu\u00e9?</p> <pre><code>location /web_muy_guay {\n    #...\n    satisfy all;    \n    deny  172.1.10.6;\n    allow 172.1.10.15;\n    allow 172.1.3.14;\n    deny  all;\n    auth_basic \"Cuesti\u00f3n final 1\";\n    auth_basic_user_file conf/htpasswd;\n}\n</code></pre> <p>No, porque aunque la ip sea admitida, debe satisfacer todos los m\u00e9todos de autentificaci\u00f3n como indica el <code>satisfy all</code></p>"},{"location":"#cuestion-2","title":"Cuesti\u00f3n 2","text":"<p>ask \"Cuesti\u00f3n 1\" Supongamos que yo soy el cliente con la IP 172.1.10.15 e intento acceder al directorio web_muy_guay de mi sitio web, introduciendo correctamente usuari y contrase\u00f1a. \u00bfPodr\u00e9 acceder?\u00bfPor qu\u00e9?</p> <pre><code>location /web_muy_guay {\n    #...\n    satisfy all;    \n    deny  all;\n    deny  172.1.10.6;\n    allow 172.1.10.15;\n    allow 172.1.3.14;\n\n    auth_basic \"Cuesti\u00f3n final 2: The revenge\";\n    auth_basic_user_file conf/htpasswd;\n}\n</code></pre> <p>En este caso, aunque introduzcamos correctamente el usuario y contrase\u00f1a, al estar <code>deny all</code> al principio del todo deniega el acceso a todas las ips. Por lo que no podr\u00edamos acceder.</p>"},{"location":"#cuestion-3","title":"Cuesti\u00f3n 3","text":"<p>Supongamos que yo soy el cliente con la IP 172.1.10.15 e intento acceder al directorio web_muy_guay de mi sitio web, introduciendo correctamente usuario y contrase\u00f1a. \u00bfPodr\u00e9 acceder?\u00bfPor qu\u00e9?</p> <pre><code>location /web_muy_guay {\n    #...\n    satisfy any;    \n    deny  172.1.10.6;\n    deny 172.1.10.15;\n    allow 172.1.3.14;\n\n    auth_basic \"Cuesti\u00f3n final 3: The final combat\";\n    auth_basic_user_file conf/htpasswd;\n}\n</code></pre> <p>No, porque nuestra ip est\u00e1 denegada.</p>"},{"location":"#cuestion-4","title":"Cuesti\u00f3n 4","text":"<p>A lo mejor no sab\u00e9is que tengo una web para documentar todas mis excursiones espaciales con Jeff, es esta: Jeff Bezos y yo</p> <p>Supongamos que quiero restringir el acceso al directorio de proyectos porque es muy secreto, eso quiere decir a\u00f1adir autenticaci\u00f3n b\u00e1sica a la URL:Proyectos</p> <p>Completa la configuraci\u00f3n para conseguirlo:</p> <pre><code>    server {\n        listen 80;\n        listen [::]:80;\n        root /var/www/freewebsitetemplates.com/preview/space-science;\n        index index.html index.htm index.nginx-debian.html;\n        server_name freewebsitetemplates.com www.freewebsitetemplates.com;\n        location /Proyectos{\n            auth_basic \"Cuesti\u00f3n final 4\";\n            auth_basic_user_file conf/htpasswd;\n            try_files $uri $uri/ =404;\n        }\n    }\n</code></pre>"}]}